"use strict";

const fs = require("fs");
const path = require("path");
const { ESLint } = require("eslint");
const prettier = require("prettier");
const { pluginId } = require("./plugin-id");
const { rules } = require("./rules");

const filePath = path.resolve(__dirname, "../../lib/configs/recommended.js");
const rawContent = `/* DON'T EDIT THIS FILE. This is generated by 'scripts/lib/update-lib-configs-recommended.js' */
"use strict"

module.exports = {
    plugins: ["${pluginId}"],
    rules: {
        ${rules
            .filter((rule) => rule.recommended)
            .map((rule) => `"${rule.id}": "error"`)
            .join(",\n        ")}
    }
};
`;
const engine = new ESLint({ fix: true });

engine.lintText(rawContent, { filePath }).then(async (results) => {
    const content = results[0].output || rawContent;

    fs.writeFileSync(
        filePath,
        prettier.format(content, {
            ...(await prettier.resolveConfig(filePath)),
            filepath: filePath,
        })
    );
});
