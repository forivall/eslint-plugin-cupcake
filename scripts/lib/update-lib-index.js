"use strict";

const fs = require("fs");
const path = require("path");
const { ESLint } = require("eslint");
const prettier = require("prettier");
const { rules } = require("./rules");

const filePath = path.resolve(__dirname, "../../lib/index.js");
const rawContent = `/* DON'T EDIT THIS FILE. This is generated by 'scripts/lib/update-lib-index.js' */
"use strict"

module.exports = {
    configs: {
        recommended: require("./configs/recommended")
    },
    rules: {
        ${rules
            .map((rule) => `"${rule.name}": require("./rules/${rule.name}")`)
            .join(",\n        ")}
    }
};
`;
const engine = new ESLint({ fix: true });

engine.lintText(rawContent, { filePath }).then(async (results) => {
    const content = results[0].output || rawContent;

    fs.writeFileSync(
        filePath,
        prettier.format(content, {
            ...(await prettier.resolveConfig(filePath)),
            filepath: filePath,
        })
    );
});
